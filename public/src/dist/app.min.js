!function(e){"use strict";function o(e){e.theme("default").primaryPalette("indigo").accentPalette("pink")}e.module("waka",["ui.router","ngResource","ngMaterial","ngFileUpload","ngImgCrop"]),e.module("waka").config(["$mdThemingProvider",o])}(angular),function(e){"use strict";function o(e,o){e.state("user-login",{url:"/user-login",templateUrl:"app/routes/user-login/user-login.html",controller:"loginController",controllerAs:"account"}).state("home-page",{url:"/home-page",templateUrl:"app/routes/home-page/home-page.html",controller:"homeController",controllerAs:"home"}).state("user-setting",{url:"/user-setting",templateUrl:"app/routes/user-setting/user-setting.html",controller:"userSettingController",controllerAs:"vm"}).state("user-page",{url:"/user-page",templateUrl:"app/routes/user-page/user-page.html",controller:"userPageController",controllerAs:"vm"}).state("user-page.answer",{url:"/answer",views:{"user-page":{templateUrl:"app/routes/user-page-answer/user-page-answer.html",controller:"userAnswerController",controllerAs:"vm"}}}).state("user-page.collection",{url:"/collection",views:{"user-page":{templateUrl:"app/routes/user-page-collection/user-page-collection.html",controller:"userCollectionController",controllerAs:"vm"}}}).state("user-page.question",{url:"/question",views:{"user-page":{templateUrl:"app/routes/user-page-question/user-page-question.html",controller:"userQuestionController",controllerAs:"vm"}}}).state("user-page.topic",{url:"/topic",views:{"user-page":{templateUrl:"app/routes/user-page-topic/user-page-topic.html",controller:"userTopicController",controllerAs:"vm"}}}),o.otherwise("/user-login")}e.module("waka").config(["$stateProvider","$urlRouterProvider",o])}(angular),function(e){e.module("waka").constant("STATUS",{SUCCESS:0,FAILED:1,NOLOGIN:2,ILLEGAL:3,NOTFOUND:4,NOEXIST:5,EXCEPTION:100})}(angular),function(e){"use strict";var o="api";e.module("waka").factory("URL",[function(){return o+"/"}]).factory("User",["$resource",function(e){return e(o+"/user",{},{login:{method:"POST",url:o+"/user/login"},logout:{method:"GET",url:o+"/user/logout"},getCurrentUser:{method:"GET",url:o+"/user/currentUser"},update:{method:"POST",url:o+"/user/update"},updatePassword:{method:"POST",url:o+"/user/password"}})}])}(angular),function(e){"use strict";function o(){function e(e,o,t,r){function n(){o.go("user-page")}function s(){o.go("user-setting")}function a(){l(),r.logout(),o.go("user-login")}function l(){var e=document.cookie.split(";");e.forEach(function(e){document.cookie=e+";max-age=0"})}var u=this;u.isOpen=!1,u.tooltipVisible=!1,e.$watch("vm.isOpen",function(e){e?t(function(){u.tooltipVisible=u.isOpen},600):u.tooltipVisible=u.isOpen}),u.items=[{name:"我的主页",icon:"",direction:"left",action:"toHomePage"},{name:"修改信息",icon:"",direction:"left",action:"toUpdateInfo"},{name:"退出",icon:"",direction:"left",action:"logout"}],u.action=function(e){switch(e){case"toHomePage":n();break;case"toUpdateInfo":s();break;case"logout":a()}}}var o={restrict:"E",templateUrl:"app/components/navbar/navbar.html",scope:{creationDate:"="},controller:e,controllerAs:"vm",bindToController:!0};return o}e.module("waka").directive("navBar",o)}(angular),function(e){"use strict";function o(e,o,t,r){}e.module("waka").controller("homeController",["$scope","$state","User","STATUS",o])}(angular),function(e){"use strict";function o(e,o,t,r){function n(e){r.login(e).$promise.then(function(r){if(console.log(r),-1===r.status)switch(r.error){case"user":case"password":return c.auth.loginErr=!0,void o(s,4e3)}r.status>-1&&(l("uid")||(console.log("set cookie"),a(r.data._id,r.data.username,e.password)),t.go("home-page"))})}function s(){c.auth={email:!1,pass:!1,userExist:!1,loginErr:!1,emailExist:!1}}function a(e,o,t){o=u(o),t=u(t),document.cookie="uid="+e+";max-age=864000",document.cookie="username="+o+";max-age=864000",document.cookie="password="+t+";max-age=864000"}function l(e){var o=document.cookie;if(o){o=o.substr(o.indexOf(e));var t=o.indexOf(";")>-1?o.indexOf(";"):o.length,r=o.substring(o.indexOf("=")+1,t);return r}return null}function u(e){return CryptoJS.AES.encrypt(e,"iwaka")}function i(e){return CryptoJS.AES.decrypt(e,"iwaka").toString(CryptoJS.enc.Utf8)}var c=this,p=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;c.signin=!0,c.auth={email:!1,pass:!1,loginErr:!1,userExist:!1,emailExist:!1},function(){if(l("uid")){var e={username:i(l("username")),password:i(l("password"))};n(e)}}(),c.login=function(){var e={email:p.test(c.email)?c.email:"",username:p.test(c.email)?"":c.email,password:c.password};n(e)},c.signup=function(){var e=c.reg;if(e.password!==e.password2)return c.auth.pass=!0,void o(s,4e3);if(!p.test(e.email))return c.auth.email=!0,void o(s,4e3);var n={username:e.username,email:e.email,password:e.password};r.save(n).$promise.then(function(e){if(console.log(e),-1===e.status)switch(e.error){case"email":return c.auth.emailExist=!0,void o(s,4e3);case"username":return c.auth.userExist=!0,void o(s,4e3)}e.status>-1&&(console.log("signup success"),t.go("home-page"))},function(e){console.log("signup fail"),console.log(e)})}}e.module("waka").controller("loginController",["$scope","$timeout","$state","User",o])}(angular),function(e){"use strict";function o(e,o,t){var r=this;r.itemList=[{title:"我的提问",url:"question"},{title:"我的回答",url:"answer"},{title:"我的收藏",url:"collection"},{title:"关注话题",url:"topic"}],r.userSetting=function(){o.go("user-setting")}}e.module("waka").controller("userPageController",["$scope","$state","User",o])}(angular),function(e){"use strict";function o(e,o,t){}e.module("waka").controller("userAnswerController",["$scope","$state","User",o])}(angular),function(e){"use strict";function o(e,o,t){}e.module("waka").controller("userCollectionController",["$scope","$state","User",o])}(angular),function(e){"use strict";function o(e,o,t){}e.module("waka").controller("userQuestionController",["$scope","$state","User",o])}(angular),function(e){"use strict";function o(e,o,t){}e.module("waka").controller("userTopicController",["$scope","$state","User",o])}(angular),function(e){"use strict";function o(e,o,t,r,n){var s=this;s.picFile="",s.username="",s.bio="",s.description="",s.oldPassword="",s.newPassword="",s.newPassword2="",s.updateInfo=function(){var e={username:s.username,bio:s.bio,description:s.description};r.update(e).$promise.then(function(e){console.log(e),e.status>-1&&alert("更新成功")})},s.updatePassword=function(){s.newPassword!==s.newPassword2&&alert("两次输入的密码不一样");var e={oldPassword:s.oldPassword,newPassword:s.newPassword};r.updatePassword(e).$promise.then(function(e){console.log(e),e.error?alert("旧密码不正确"):alert("修改密码成功")})},s.upload=function(e){console.log(e),n.upload({url:"/api/user/imgUpload",file:n.dataUrltoBlob(e)}).then(function(e){t(function(){s.result=e.data})},function(e){e.status>0&&(s.errorMsg=e.status+": "+e.data)},function(e){s.progress=parseInt(100*e.loaded/e.total),console.log("progress: "+s.progress+"% ")})}}e.module("waka").controller("userSettingController",["$scope","$state","$timeout","User","Upload",o])}(angular);