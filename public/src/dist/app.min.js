!function(e){"use strict";function t(e){e.theme("default").primaryPalette("indigo").accentPalette("pink")}e.module("waka",["ui.router","ngResource","ngMaterial","ngFileUpload","ngImgCrop"]),e.module("waka").config(["$mdThemingProvider",t])}(angular),function(e){"use strict";function t(e,t){e.state("user-login",{url:"/user-login",templateUrl:"app/routes/user-login/user-login.html",controller:"loginController",controllerAs:"account"}).state("home-page",{url:"/home-page",templateUrl:"app/routes/home-page/home-page.html",controller:"homeController",controllerAs:"home"}).state("user-setting",{url:"/user-setting",templateUrl:"app/routes/user-setting/user-setting.html",controller:"userSettingController",controllerAs:"vm"}).state("user-page",{url:"/user-page",templateUrl:"app/routes/user-page/user-page.html",controller:"userPageController",controllerAs:"vm"}).state("user-page.answer",{url:"/answer",views:{"user-page":{templateUrl:"app/routes/user-page-answer/user-page-answer.html",controller:"userAnswerController",controllerAs:"vm"}}}).state("user-page.collection",{url:"/collection",views:{"user-page":{templateUrl:"app/routes/user-page-collection/user-page-collection.html",controller:"userCollectionController",controllerAs:"vm"}}}).state("user-page.question",{url:"/question",views:{"user-page":{templateUrl:"app/routes/user-page-question/user-page-question.html",controller:"userQuestionController",controllerAs:"vm"}}}).state("user-page.topic",{url:"/topic",views:{"user-page":{templateUrl:"app/routes/user-page-topic/user-page-topic.html",controller:"userTopicController",controllerAs:"vm"}}}).state("find-question",{url:"/find-question",templateUrl:"app/routes/find-question-page/find-question-page.html",controller:"findQuestionController",controllerAs:"vm"}).state("question",{url:"/question/:question_id",templateUrl:"app/routes/question/question.html",controller:"questionController",controllerAs:"vm"}).state("question-editor",{url:"/question-editor",templateUrl:"app/routes/question-editor/question-editor.html",controller:"questionEditorController",controllerAs:"vm"}).state("answer-editor",{url:"/answer-editor",templateUrl:"app/routes/answer-editor/answer-editor.html",controller:"answerEditorController",controllerAs:"vm"}),t.otherwise("/user-login")}e.module("waka").config(["$stateProvider","$urlRouterProvider",t])}(angular),function(e){"use strict";var t="api";e.module("waka").factory("URL",[function(){return t+"/"}]).factory("User",["$resource",function(e){var o=t+"/user/";return e(t+"/user/:id",{id:"@id"},{login:{method:"POST",url:o+"login"},logout:{method:"GET",url:o+"logout"},getCurrentUser:{method:"GET",url:o+"currentUser"},update:{method:"POST",url:o+"update"},updatePassword:{method:"POST",url:o+"password"}})}]).factory("Question",["$resource",function(e){var o=t+"/question/";return e(t+"/question/:question_id",{question_id:"@question_id"},{add:{method:"POST",url:o+"add"},search:{method:"POST",url:o+"search"},update:{method:"POST",url:o+"update"},getNoAnswer:{method:"POST",url:o+"getNoAnswer"},getNew:{method:"POST",url:o+"getNew"},getHot:{method:"POST",url:o+"getHot"},getByUser:{method:"GET",url:o+"getByUser/:author_id",params:{author_id:"@author_id"}},attitude:{method:"POST",url:o+"attitude"},follow:{method:"POST",url:o+"follow"},getFollower:{method:"GET",url:o+"getFollower/:question_id",params:{question_id:"@question_id"}},getFollwerList:{method:"GET",url:o+"getFollwerList/:follower_id",params:{follower_id:"@follower_id"}}})}]).factory("Answer",["$resource",function(e){var o=t+"/answer/";return e(t+"/answer",{},{getByTopic:{method:"POST",url:o+"getByTopic"},getByUserTopics:{method:"POST",url:o+"getByUserTopics"},getByQuestion:{method:"GET",url:o+"getByQuestion/:question_id",params:{question_id:"@question_id"}},getByUser:{method:"GET",url:o+"getByUser/:author_id",params:{author_id:"@author_id"}},collection:{method:"GET",url:o+"collection/:user_id",params:{user_id:"@user_id"}},addCollection:{method:"POST",url:o+"addCollection"},attitude:{method:"POST",url:o+"attitude"},add:{method:"POST",url:o+"add"},update:{method:"POST",url:o+"update"},del:{method:"POST",url:o+"del"}})}]).factory("Topic",["$resource",function(e){var o=t+"/topic/";return e(t+"/topic",{},{add:{method:"POST",url:o+"add"},sub:{method:"GET",url:o+"sub/:name",params:{name:"@name"}},update:{method:"POST",url:o+"update"}})}]).factory("Reply",["$resource",function(e){var o=t+"/reply/";return e(t+"/reply",{},{add:{method:"POST",url:o+"add"},update:{method:"POST",url:o+"update"},del:{method:"POST",url:o+"del"},list:{method:"GET",url:o+"list/:answer_id",params:{answer_id:"@answer_id"}}})}]).factory("Message",["$resource",function(e){var o=t+"/message/";return e(t+"/message",{},{getMes:{method:"POST",url:o+"getMes"}})}])}(angular),function(e){"use strict";e.module("waka").factory("iAES",function(){return{encrypt:function(e){return CryptoJS.AES.encrypt(e,"iwaka")},decrypt:function(e){return CryptoJS.AES.decrypt(e,"iwaka").toString(CryptoJS.enc.Utf8)}}}).factory("iCookie",function(){return{setUserCookie:function(e,t,o){document.cookie="uid="+e+";max-age=864000",document.cookie="username="+t+";max-age=864000",document.cookie="password="+o+";max-age=864000"},setCookie:function(e,t,o){document.cookie=e+"="+t+";max-age="+o},getCookie:function(e){var t=document.cookie;if(t){t=t.substr(t.indexOf(e));var o=t.indexOf(";")>-1?t.indexOf(";"):t.length,r=t.substring(t.indexOf("=")+1,o);return r}return null},cancelCookie:function(){var e=document.cookie.split(";");e.forEach(function(e){document.cookie=e+";max-age=0"})},updatePasswordCookie:function(e){e=e,document.cookie="password="+e+";max-age=864000"}}})}(angular),function(e){"use strict";e.module("waka").factory("timeFormat",function(){return{postedTime:function(e){var t=new Date(e),o=new Date,r=(o-t)/6e4;return 60>=r?Math.floor(r)+"分钟前":r>60&&1440>=r?Math.floor(r/60)+"小时前":r>1440&&28800>=r?Math.floor(r/1440)+"天前":t.getYear()+"-"+t.getMonth()+"-"+t.getDate()}}})}(angular),function(e){function t(){function e(e,t,o,r){var n=this,s=new SimpleMDE({element:document.getElementById("editor")});n.submit=function(){},n.show=function(){console.log(s.markdown(s.value()))}}var t={restrict:"E",templateUrl:"app/components/editor/editor.html",scope:{},controller:e,controllerAs:"vm",bindToController:!0};return t}e.module("waka").directive("myEditor",t)}(angular),function(e){"use strict";function t(){function e(e,t,o,r){function n(){location.href="/#/user-page"}function s(){location.href="/#/user-setting"}function a(){u(),r.logout(),t.go("user-login")}function i(){r.get({id:l("uid")}).$promise.then(function(e){c.avatar="../assets/images/user/"+e.data.avatar})}function u(){var e=document.cookie.split(";");e.forEach(function(e){document.cookie=e+";max-age=0"})}function l(e){var t=document.cookie;if(t){t=t.substr(t.indexOf(e));var o=t.indexOf(";")>-1?t.indexOf(";"):t.length,r=t.substring(t.indexOf("=")+1,o);return r}return null}var c=this,d="../assets/images/icons/";c.isOpen=!1,c.tooltipVisible=!1,c.avatar="../assets/images/user/default.png",i(),e.$watch("vm.isOpen",function(e){e?o(function(){c.tooltipVisible=c.isOpen},600):c.tooltipVisible=c.isOpen}),c.items=[{name:"我的主页",icon:d+"people.svg",direction:"left",action:"toHomePage"},{name:"修改信息",icon:d+"setting.svg",direction:"left",action:"toUpdateInfo"},{name:"退出",icon:d+"logout.svg",direction:"left",action:"logout"}],c.action=function(e){switch(e){case"toHomePage":n();break;case"toUpdateInfo":s();break;case"logout":a()}}}var t={restrict:"E",templateUrl:"app/components/navbar/navbar.html",scope:{creationDate:"="},controller:e,controllerAs:"vm",bindToController:!0};return t}e.module("waka").directive("navBar",t)}(angular),function(e){"use strict";function t(e,t,o){}e.module("waka").controller("answerEditorController",["$scope","$state","Question",t])}(angular),function(e){"use strict";function t(e,t,o){}e.module("waka").controller("findQuestionController",["$scope","$state","Question",t])}(angular),function(e){"use strict";function t(e,t,o){}e.module("waka").controller("homeController",["$scope","$state","User",t])}(angular),function(e){"use strict";function t(e,t,o,r,n){function s(){var e=location.hash.split("/");console.log(e),o.get({question_id:e[2]}).$promise.then(function(e){if(e.status>-1){console.log(e);var t=e.data[0];i.question=t.question,i.question.author=t.author,i.question.createdTime=r.postedTime(i.question.created_time),a(i.question._id)}else alert("getQuestion error")})}function a(e){n.getByQuestion({question_id:e}).$promise.then(function(e){e.status>-1?i.answerList=e.data:alert("getAnswers error")})}var i=this;i.answerList=[],i.question="",s(),i.postedTime=r.postedTime}e.module("waka").controller("questionController",["$scope","$state","Question","timeFormat","Answer",t])}(angular),function(e){"use strict";function t(e,t,o){}e.module("waka").controller("questionEditorController",["$scope","$state","Question",t])}(angular),function(e){"use strict";function t(e,t,o,r){function n(e){r.login(e).$promise.then(function(r){if(console.log(r),-1===r.status)switch(r.error){case"user":case"password":return c.auth.loginErr=!0,void t(s,4e3)}r.status>-1&&(i("uid")||(console.log("set cookie"),a(r.data._id,r.data.username,e.password)),t(function(){o.go("home-page")},1e3))})}function s(){c.auth={email:!1,pass:!1,userExist:!1,loginErr:!1,emailExist:!1}}function a(e,t,o){t=u(t),o=u(o),document.cookie="uid="+e+";max-age=864000",document.cookie="username="+t+";max-age=864000",document.cookie="password="+o+";max-age=864000"}function i(e){var t=document.cookie;if(t){t=t.substr(t.indexOf(e));var o=t.indexOf(";")>-1?t.indexOf(";"):t.length,r=t.substring(t.indexOf("=")+1,o);return r}return null}function u(e){return CryptoJS.AES.encrypt(e,"iwaka")}function l(e){return CryptoJS.AES.decrypt(e,"iwaka").toString(CryptoJS.enc.Utf8)}var c=this,d=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;c.signin=!0,c.auth={email:!1,pass:!1,loginErr:!1,userExist:!1,emailExist:!1},function(){if(i("uid")){var e={username:l(i("username")),password:l(i("password"))};n(e)}}(),c.login=function(){var e={email:d.test(c.email)?c.email:"",username:d.test(c.email)?"":c.email,password:c.password};n(e)},c.signup=function(){var e=c.reg;if(e.password!==e.password2)return c.auth.pass=!0,void t(s,4e3);if(!d.test(e.email))return c.auth.email=!0,void t(s,4e3);var n={username:e.username,email:e.email,password:e.password};r.save(n).$promise.then(function(e){if(console.log(e),-1===e.status)switch(e.error){case"email":return c.auth.emailExist=!0,void t(s,4e3);case"username":return c.auth.userExist=!0,void t(s,4e3)}e.status>-1&&(console.log("signup success"),o.go("home-page"))},function(e){console.log("signup fail"),console.log(e)})}}e.module("waka").controller("loginController",["$scope","$timeout","$state","User",t])}(angular),function(e){"use strict";function t(e,t,o){var r=this;r.itemList=[{title:"我的提问",url:"question"},{title:"我的回答",url:"answer"},{title:"我的收藏",url:"collection"},{title:"关注话题",url:"topic"}],r.userSetting=function(){t.go("user-setting")}}e.module("waka").controller("userPageController",["$scope","$state","User",t])}(angular),function(e){"use strict";function t(e,t,o){}e.module("waka").controller("userAnswerController",["$scope","$state","User",t])}(angular),function(e){"use strict";function t(e,t,o){}e.module("waka").controller("userCollectionController",["$scope","$state","User",t])}(angular),function(e){"use strict";function t(e,t,o){}e.module("waka").controller("userQuestionController",["$scope","$state","User",t])}(angular),function(e){"use strict";function t(e,t,o){}e.module("waka").controller("userTopicController",["$scope","$state","User",t])}(angular),function(e){"use strict";function t(e,t,o,r,n){function s(){r.getCurrentUser().$promise.then(function(e){var t=e.data;u.username=t.username,u.bio=t.bio,u.description=t.description})}function a(e){e=i(e),document.cookie="password="+e+";max-age=864000"}function i(e){return CryptoJS.AES.encrypt(e,"iwaka")}var u=this;u.picFile="",u.username="",u.bio="",u.description="",u.oldPassword="",u.newPassword="",u.newPassword2="",u.savingAvatar=!1,u.savingInfo=!1,u.savingPassword=!1,s(),u.updateInfo=function(){var e={username:u.username,bio:u.bio,description:u.description};r.update(e).$promise.then(function(e){u.savingInfo=!0,e.status>-1&&o(function(){u.savingInfo=!1,u.savingInfoMes="保存成功"},2e3)})},u.updatePassword=function(){u.newPassword!==u.newPassword2&&(u.savingPasswordMes="密码不一致");var e={oldPassword:u.oldPassword,newPassword:u.newPassword};r.updatePassword(e).$promise.then(function(e){u.savingPassword=!0,console.log(e),e.data.error?(u.savingPassword=!1,u.savingPasswordMes="旧密码不正确"):o(function(){u.savingPassword=!1,u.savingPasswordMes="保存成功",a(u.newPassword)},2e3)})},u.upload=function(e){u.savingAvatar=!0,n.upload({url:"/api/user/imgUpload",file:n.dataUrltoBlob(e)}).then(function(e){e.status>-1&&o(function(){window.location.reload()},2500)})}}e.module("waka").controller("userSettingController",["$scope","$state","$timeout","User","Upload",t])}(angular);