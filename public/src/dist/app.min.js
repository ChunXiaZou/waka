!function(e){"use strict";function o(e){e.theme("default").primaryPalette("indigo").accentPalette("pink")}e.module("waka",["ui.router","ngResource","ngMaterial","ngFileUpload","ngImgCrop"]),e.module("waka").config(["$mdThemingProvider",o])}(angular),function(e){"use strict";function o(e,o){e.state("user-login",{url:"/user-login",templateUrl:"app/routes/user-login/user-login.html",controller:"loginController",controllerAs:"account"}).state("home-page",{url:"/home-page",templateUrl:"app/routes/home-page/home-page.html",controller:"homeController",controllerAs:"home"}).state("user-setting",{url:"/user-setting",templateUrl:"app/routes/user-setting/user-setting.html",controller:"userSettingController",controllerAs:"vm"}).state("user-page",{url:"/user-page",templateUrl:"app/routes/user-page/user-page.html",controller:"userPageController",controllerAs:"vm"}).state("user-page.answer",{url:"/answer",views:{"user-page":{templateUrl:"app/routes/user-page-answer/user-page-answer.html",controller:"userAnswerController",controllerAs:"vm"}}}).state("user-page.collection",{url:"/collection",views:{"user-page":{templateUrl:"app/routes/user-page-collection/user-page-collection.html",controller:"userCollectionController",controllerAs:"vm"}}}).state("user-page.question",{url:"/question",views:{"user-page":{templateUrl:"app/routes/user-page-question/user-page-question.html",controller:"userQuestionController",controllerAs:"vm"}}}).state("user-page.topic",{url:"/topic",views:{"user-page":{templateUrl:"app/routes/user-page-topic/user-page-topic.html",controller:"userTopicController",controllerAs:"vm"}}}).state("find-question",{url:"/find-question",templateUrl:"app/routes/find-question-page/find-question-page.html",controller:"findQuestionController",controllerAs:"vm"}).state("question",{url:"/question",templateUrl:"app/routes/question/question.html",controller:"questionController",controllerAs:"vm"}),o.otherwise("/user-login")}e.module("waka").config(["$stateProvider","$urlRouterProvider",o])}(angular),function(e){e.module("waka").constant("STATUS",{SUCCESS:0,FAILED:1,NOLOGIN:2,ILLEGAL:3,NOTFOUND:4,NOEXIST:5,EXCEPTION:100})}(angular),function(e){"use strict";var o="api";e.module("waka").factory("URL",[function(){return o+"/"}]).factory("User",["$resource",function(e){return e(o+"/user",{},{login:{method:"POST",url:o+"/user/login"},logout:{method:"GET",url:o+"/user/logout"},getCurrentUser:{method:"GET",url:o+"/user/currentUser"},update:{method:"POST",url:o+"/user/update"},updatePassword:{method:"POST",url:o+"/user/password"}})}]).factory("Question",["$resource",function(e){return e(o+"/question",{},{})}])}(angular),function(e){"use strict";function o(){function e(e,o,t,r){function n(){location.href="/#/user-page"}function s(){location.href="/#/user-setting"}function a(){i(),r.logout(),o.go("user-login")}function i(){var e=document.cookie.split(";");e.forEach(function(e){document.cookie=e+";max-age=0"})}function u(e){var o=document.cookie;if(o){o=o.substr(o.indexOf(e));var t=o.indexOf(";")>-1?o.indexOf(";"):o.length,r=o.substring(o.indexOf("=")+1,t);return r}return null}var l=this,c="../assets/images/icons/";l.isOpen=!1,l.tooltipVisible=!1,l.avatar="../assets/images/user/"+u("uid")+".png",e.$watch("vm.isOpen",function(e){e?t(function(){l.tooltipVisible=l.isOpen},600):l.tooltipVisible=l.isOpen}),l.items=[{name:"我的主页",icon:c+"people.svg",direction:"left",action:"toHomePage"},{name:"修改信息",icon:c+"setting.svg",direction:"left",action:"toUpdateInfo"},{name:"退出",icon:c+"logout.svg",direction:"left",action:"logout"}],l.action=function(e){switch(e){case"toHomePage":n();break;case"toUpdateInfo":s();break;case"logout":a()}}}var o={restrict:"E",templateUrl:"app/components/navbar/navbar.html",scope:{creationDate:"="},controller:e,controllerAs:"vm",bindToController:!0};return o}e.module("waka").directive("navBar",o)}(angular),function(e){"use strict";function o(e,o,t){}e.module("waka").controller("findQuestionController",["$scope","$state","Question",o])}(angular),function(e){"use strict";function o(e,o,t,r){}e.module("waka").controller("homeController",["$scope","$state","User","STATUS",o])}(angular),function(e){"use strict";function o(e,o,t){}e.module("waka").controller("questionController",["$scope","$state","Question",o])}(angular),function(e){"use strict";function o(e,o,t,r){function n(e){r.login(e).$promise.then(function(r){if(console.log(r),-1===r.status)switch(r.error){case"user":case"password":return c.auth.loginErr=!0,void o(s,4e3)}r.status>-1&&(i("uid")||(console.log("set cookie"),a(r.data._id,r.data.username,e.password)),o(function(){t.go("home-page")},1e3))})}function s(){c.auth={email:!1,pass:!1,userExist:!1,loginErr:!1,emailExist:!1}}function a(e,o,t){o=u(o),t=u(t),document.cookie="uid="+e+";max-age=864000",document.cookie="username="+o+";max-age=864000",document.cookie="password="+t+";max-age=864000"}function i(e){var o=document.cookie;if(o){o=o.substr(o.indexOf(e));var t=o.indexOf(";")>-1?o.indexOf(";"):o.length,r=o.substring(o.indexOf("=")+1,t);return r}return null}function u(e){return CryptoJS.AES.encrypt(e,"iwaka")}function l(e){return CryptoJS.AES.decrypt(e,"iwaka").toString(CryptoJS.enc.Utf8)}var c=this,p=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;c.signin=!0,c.auth={email:!1,pass:!1,loginErr:!1,userExist:!1,emailExist:!1},function(){if(i("uid")){var e={username:l(i("username")),password:l(i("password"))};n(e)}}(),c.login=function(){var e={email:p.test(c.email)?c.email:"",username:p.test(c.email)?"":c.email,password:c.password};n(e)},c.signup=function(){var e=c.reg;if(e.password!==e.password2)return c.auth.pass=!0,void o(s,4e3);if(!p.test(e.email))return c.auth.email=!0,void o(s,4e3);var n={username:e.username,email:e.email,password:e.password};r.save(n).$promise.then(function(e){if(console.log(e),-1===e.status)switch(e.error){case"email":return c.auth.emailExist=!0,void o(s,4e3);case"username":return c.auth.userExist=!0,void o(s,4e3)}e.status>-1&&(console.log("signup success"),t.go("home-page"))},function(e){console.log("signup fail"),console.log(e)})}}e.module("waka").controller("loginController",["$scope","$timeout","$state","User",o])}(angular),function(e){"use strict";function o(e,o,t){var r=this;r.itemList=[{title:"我的提问",url:"question"},{title:"我的回答",url:"answer"},{title:"我的收藏",url:"collection"},{title:"关注话题",url:"topic"}],r.userSetting=function(){o.go("user-setting")}}e.module("waka").controller("userPageController",["$scope","$state","User",o])}(angular),function(e){"use strict";function o(e,o,t){}e.module("waka").controller("userAnswerController",["$scope","$state","User",o])}(angular),function(e){"use strict";function o(e,o,t){}e.module("waka").controller("userCollectionController",["$scope","$state","User",o])}(angular),function(e){"use strict";function o(e,o,t){}e.module("waka").controller("userQuestionController",["$scope","$state","User",o])}(angular),function(e){"use strict";function o(e,o,t){}e.module("waka").controller("userTopicController",["$scope","$state","User",o])}(angular),function(e){"use strict";function o(e,o,t,r,n){function s(){r.getCurrentUser().$promise.then(function(e){var o=e.data;u.username=o.username,u.bio=o.bio,u.description=o.description})}function a(e){e=i(e),document.cookie="password="+e+";max-age=864000"}function i(e){return CryptoJS.AES.encrypt(e,"iwaka")}var u=this;u.picFile="",u.username="",u.bio="",u.description="",u.oldPassword="",u.newPassword="",u.newPassword2="",u.savingAvatar=!1,u.savingInfo=!1,u.savingPassword=!1,s(),u.updateInfo=function(){var e={username:u.username,bio:u.bio,description:u.description};r.update(e).$promise.then(function(e){u.savingInfo=!0,e.status>-1&&t(function(){u.savingInfo=!1,u.savingInfoMes="保存成功"},2e3)})},u.updatePassword=function(){u.newPassword!==u.newPassword2&&(u.savingPasswordMes="密码不一致");var e={oldPassword:u.oldPassword,newPassword:u.newPassword};r.updatePassword(e).$promise.then(function(e){u.savingPassword=!0,console.log(e),e.data.error?(u.savingPassword=!1,u.savingPasswordMes="旧密码不正确"):t(function(){u.savingPassword=!1,u.savingPasswordMes="保存成功",a(u.newPassword)},2e3)})},u.upload=function(e){u.savingAvatar=!0,n.upload({url:"/api/user/imgUpload",file:n.dataUrltoBlob(e)}).then(function(e){e.status>-1&&t(function(){window.location.reload()},2500)})}}e.module("waka").controller("userSettingController",["$scope","$state","$timeout","User","Upload",o])}(angular);